<ResourceDictionary
    x:Class="LucasAlias.NINA.NEK.Dockables.NikonMtpDockableNekTemplates"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
    xmlns:local="clr-namespace:LucasAlias.NINA.NEK.Dockables"
    xmlns:util="clr-namespace:NINA.Core.Utility;assembly=NINA.Core"
    xmlns:ninactrl="clr-namespace:NINA.CustomControlLibrary;assembly=NINA.CustomControlLibrary"
    
    xmlns:conv="clr-namespace:LucasAlias.NINA.NEK.Dockables.Converters"
    xmlns:convNikonDevicePropDesc="clr-namespace:LucasAlias.NINA.NEK.Dockables.Converters.NikonDevicePropDesc">


    <conv:GreaterThanConverter x:Key="GreaterThanConverter" />
    <convNikonDevicePropDesc:GetTypeFormConverter x:Key="NikonDevicePropDesc_GetTypeConverter" />
    <convNikonDevicePropDesc:TryGetConverter x:Key="NikonDevicePropDesc_TryGetConverter" />


    <DataTemplate x:Key="IntegerTemplate"><!--TODO: Write the data & switch to stepper or converter-->
        <TextBox>
            <TextBox.IsEnabled>
                <Binding Path="GetSet" Converter="{StaticResource GreaterThanConverter}" ConverterParameter="0" />
            </TextBox.IsEnabled>

            <TextBox.Text>
                <Binding Path="CurrentValue" Mode="TwoWay" UpdateSourceTrigger="Explicit" />
            </TextBox.Text>
        </TextBox>
    </DataTemplate>

    <DataTemplate x:Key="StringTemplate">
        <TextBox>
            <TextBox.IsEnabled>
                <Binding Path="GetSet" Converter="{StaticResource GreaterThanConverter}" ConverterParameter="0" />
            </TextBox.IsEnabled>

            <TextBox.Text>
                <Binding Path="CurrentValue" Mode="TwoWay" UpdateSourceTrigger="LostFocus" />
            </TextBox.Text>

            <i:Interaction.Triggers>
                <i:EventTrigger EventName="LostFocus">
                    <i:InvokeCommandAction Command="{Binding DataContext.SetDevicePropertyCommand, RelativeSource={RelativeSource AncestorType=ItemsControl}}" CommandParameter="{Binding}" />
                </i:EventTrigger>
            </i:Interaction.Triggers>
        </TextBox>
    </DataTemplate>

    <DataTemplate x:Key="ArrayTemplate"><!--TODO: Write the data & switch to array friendly-->
        <TextBox>
            <TextBox.IsEnabled>
                <Binding Path="GetSet" Converter="{StaticResource GreaterThanConverter}" ConverterParameter="0" />
            </TextBox.IsEnabled>

            <TextBox.Text>
                <Binding Path="CurrentValue" Mode="TwoWay" UpdateSourceTrigger="Explicit" />
            </TextBox.Text>
        </TextBox>
    </DataTemplate>

    <DataTemplate x:Key="EnumTemplate"><!--TODO: Write the data-->
        <ComboBox>
            <ComboBox.IsEnabled>
                <Binding Path="GetSet" Converter="{StaticResource GreaterThanConverter}" ConverterParameter="0" />
            </ComboBox.IsEnabled>

            <ComboBox.SelectedValue>
                <Binding Path="CurrentValue" Mode="TwoWay" />
            </ComboBox.SelectedValue>
            <ComboBox.ItemsSource>
                <Binding Path="EnumFORM" />
            </ComboBox.ItemsSource>
        </ComboBox>
    </DataTemplate>

    <DataTemplate x:Key="RangeTemplate">
        <ninactrl:IntStepperControl>
            <ninactrl:IntStepperControl.IsEnabled>
                <Binding Path="GetSet" Converter="{StaticResource GreaterThanConverter}" ConverterParameter="0" />
            </ninactrl:IntStepperControl.IsEnabled>

            <ninactrl:IntStepperControl.Value>
                <Binding Path="CurrentValue" Mode="TwoWay" UpdateSourceTrigger="Explicit" />
            </ninactrl:IntStepperControl.Value>
            <ninactrl:IntStepperControl.MinValue>
                <Binding Path="RangeFORM.Min" />
            </ninactrl:IntStepperControl.MinValue>
            <ninactrl:IntStepperControl.MaxValue>
                <Binding Path="RangeFORM.Max" />
            </ninactrl:IntStepperControl.MaxValue>
            <ninactrl:IntStepperControl.StepSize>
                <Binding Path="RangeFORM.Step" />
            </ninactrl:IntStepperControl.StepSize>
        </ninactrl:IntStepperControl>
    </DataTemplate>

    <convNikonDevicePropDesc:TypeFormTemplateSelector
        x:Key="convNikonDevicePropDesc_TypeFormTemplateSelector"
        IntegerTemplate="{StaticResource IntegerTemplate}"
        StringTemplate="{StaticResource StringTemplate}"
        ArrayTemplate="{StaticResource ArrayTemplate}"
        EnumTemplate="{StaticResource EnumTemplate}"
        RangeTemplate="{StaticResource RangeTemplate}"
        />


    <!--  The datatemplate for the dockable is indicated by the fully qualified class name and the postfix _Dockable  -->
    <DataTemplate x:Key="LucasAlias.NINA.NEK.Dockables.NikonMtpDockableNek_Dockable">
        <Grid Margin="5">
            <Grid Visibility="{Binding Connected, Converter={StaticResource InverseBooleanToVisibilityCollapsedConverter}}">
                <TextBlock HorizontalAlignment="Center" VerticalAlignment="Center" Text="No Nikon camera connected with Nikon Ekrynox SDK" />
            </Grid>
            
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <StackPanel Grid.IsSharedSizeScope="True">
                    <ItemsControl ItemsSource="{Binding DeviceProperties}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Grid Margin="5">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" SharedSizeGroup="Col0" />
                                        <ColumnDefinition Width="Auto" SharedSizeGroup="Col1" />
                                        <ColumnDefinition Width="Auto" SharedSizeGroup="Col2" />
                                        <ColumnDefinition Width="*" SharedSizeGroup="Col3" />
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Grid.Column="0" Text="{Binding Key}" FontWeight="Bold" />
                                    <TextBlock Grid.Column="1" Text="{Binding Key, StringFormat=0x{0:X}}" FontWeight="Light" />
                                    <TextBlock Grid.Column="2" Text="{Binding Value, Converter={StaticResource NikonDevicePropDesc_GetTypeConverter}}" />

                                    <ContentControl Grid.Column="3" Content="{Binding Value, Converter={StaticResource NikonDevicePropDesc_TryGetConverter}}" ContentTemplateSelector="{StaticResource convNikonDevicePropDesc_TypeFormTemplateSelector}" />

                                </Grid>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>
            </ScrollViewer>


        </Grid>
    </DataTemplate>
</ResourceDictionary>